{
  "name": "poc",
  "nodes": [
    {
      "parameters": {
        "path": "ai-content-creator",
        "formTitle": "AI Content Creator (Agent POC)",
        "formDescription": "Generate and post multiple tweets from a transcript",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Transcript",
              "fieldType": "textarea",
              "placeholder": "Paste your video transcript here...",
              "requiredField": true
            },
            {
              "fieldLabel": "Number of Tweets",
              "fieldType": "number",
              "placeholder": "5"
            },
            {
              "fieldLabel": "Post to X?",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  { "option": "No - Just generate" },
                  { "option": "Yes - Post all tweets" }
                ]
              }
            }
          ]
        },
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "form-trigger",
      "name": "Form Trigger",
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2,
      "position": [0, 300],
      "webhookId": "951ab57d-78f5-48f8-8d44-6831ebcbcbab"
    },
    {
      "parameters": {
        "jsCode": "const formData = $('Form Trigger').first().json;\nconst tweetCount = parseInt(formData['Number of Tweets']) || 5;\n\nreturn [{\n  json: {\n    ...formData,\n    sessionId: `session-${Date.now()}`,\n    tweetCount: Math.min(Math.max(tweetCount, 3), 10),\n    postToX: formData['Post to X?'] === 'Yes - Post all tweets'\n  }\n}];"
      },
      "id": "prepare-session",
      "name": "Prepare Session",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [220, 300]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analyze this transcript and create social media content.\n\n## TRANSCRIPT:\n{{ $json.Transcript }}\n\n## REQUIREMENTS:\n- Generate exactly {{ $json.tweetCount }} tweets\n- Each tweet under 280 characters\n- No hashtags, no emojis at the start\n- Make each tweet unique and valuable\n- Also create 1 LinkedIn post\n\nReturn the structured output with all tweets and LinkedIn content.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an expert content strategist. Create engaging, specific content. Match the tone of the original. Each tweet should stand alone and provide value."
        }
      },
      "id": "ai-agent",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [440, 300],
      "notes": "ðŸ¤– ONE call to generate all tweets"
    },
    {
      "parameters": {
        "model": "moonshotai/kimi-k2-instruct-0905",
        "options": {
          "temperature": 0.7
        }
      },
      "id": "groq-chat-model",
      "name": "Groq Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
      "typeVersion": 1,
      "position": [320, 520],
      "credentials": {
        "groqApi": {
          "id": "8MsvIxF9vGRE2U0Y",
          "name": "Groq account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}",
        "contextWindowLength": 5
      },
      "id": "simple-memory",
      "name": "Simple Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [440, 520]
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"tweets\": {\n      \"type\": \"array\",\n      \"description\": \"Array of 3-10 tweets\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"content\": { \"type\": \"string\", \"description\": \"Tweet text under 280 chars\" },\n          \"type\": { \"type\": \"string\", \"description\": \"Type: contrarian, tactical, story, insight, question\" }\n        }\n      }\n    },\n    \"linkedin_hook\": { \"type\": \"string\" },\n    \"linkedin_body\": { \"type\": \"string\" },\n    \"linkedin_question\": { \"type\": \"string\" },\n    \"key_ideas\": {\n      \"type\": \"array\",\n      \"items\": { \"type\": \"string\" }\n    }\n  },\n  \"required\": [\"tweets\", \"linkedin_hook\", \"linkedin_body\", \"linkedin_question\", \"key_ideas\"]\n}"
      },
      "id": "output-parser",
      "name": "Structured Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [560, 520],
      "notes": "ðŸ“‹ Output: tweets[] array with 3-10 items"
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [
            {
              "id": "should-post",
              "leftValue": "={{ $('Prepare Session').first().json.postToX }}",
              "rightValue": true,
              "operator": { "type": "boolean", "operation": "equals" }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "should-post",
      "name": "Should Post?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [660, 300]
    },
    {
      "parameters": {
        "jsCode": "// Convert tweets array to individual items\nconst agentOutput = $('AI Agent').first().json;\nconst tweets = agentOutput.tweets || [];\n\n// Handle empty tweets array\nif (!tweets || tweets.length === 0) {\n  return [{\n    json: {\n      index: 0,\n      total: 0,\n      content: '',\n      type: 'error',\n      error: 'No tweets generated',\n      agentOutput: agentOutput\n    }\n  }];\n}\n\n// Map tweets to individual items\nreturn tweets.map((tweet, index) => ({\n  json: {\n    index: index + 1,\n    total: tweets.length,\n    content: tweet.content || '',\n    type: tweet.type || 'unknown',\n    agentOutput: agentOutput\n  }\n}));"
      },
      "id": "split-tweets",
      "name": "Split Tweets",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [880, 200],
      "notes": "ðŸ“‹ Converts tweets[] to individual items for looping"
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "id": "loop-tweets",
      "name": "Loop Tweets",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [1100, 200],
      "notes": "ðŸ”„ Process one tweet at a time"
    },
    {
      "parameters": {
        "resource": "tweet",
        "text": "={{ $json.content }}"
      },
      "id": "post-to-x",
      "name": "Post to X",
      "type": "n8n-nodes-base.twitter",
      "typeVersion": 2,
      "position": [1320, 200],
      "credentials": {
        "twitterOAuth2Api": {
          "id": "TtzUMmUcFebH8T9X",
          "name": "X account"
        }
      },
      "notes": "ðŸ¦ Posts each tweet"
    },
    {
      "parameters": {
        "amount": 60,
        "unit": "seconds"
      },
      "id": "wait-60s",
      "name": "Wait 60s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [1540, 200],
      "notes": "â³ 60 second delay between tweets"
    },
    {
      "parameters": {
        "jsCode": "// Collect all posted tweets\nconst allItems = $('Post to X').all();\nconst agentOutput = $('Split Tweets').first().json.agentOutput;\n\nconst postedTweets = allItems.map((item, i) => ({\n  id: item.json?.data?.id,\n  text: item.json?.data?.text?.substring(0, 50) + '...'\n}));\n\nlet message = 'âœ… Content Generated & Posted!\\n\\n';\nmessage += 'ðŸ“ KEY IDEAS:\\n';\nmessage += (agentOutput.key_ideas || []).map(i => `â€¢ ${i}`).join('\\n');\nmessage += `\\n\\nðŸ¦ TWEETS POSTED (${postedTweets.length}):\\n`;\npostedTweets.forEach((t, i) => {\n  message += `${i+1}. ${t.text}\\n   â†’ https://x.com/i/status/${t.id}\\n`;\n});\nmessage += '\\nðŸ’¼ LINKEDIN POST:\\n';\nmessage += `Hook: ${agentOutput.linkedin_hook}\\n`;\nmessage += `Body: ${agentOutput.linkedin_body?.substring(0, 100)}...\\n`;\nmessage += `Question: ${agentOutput.linkedin_question}`;\n\nreturn [{ json: { message } }];"
      },
      "id": "build-posted-response",
      "name": "Build Posted Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1320, 400]
    },
    {
      "parameters": {
        "jsCode": "// Just show generated content without posting\nconst agentOutput = $('AI Agent').first().json;\n\nlet message = 'âœ… Content Generated (not posted)\\n\\n';\nmessage += 'ðŸ“ KEY IDEAS:\\n';\nmessage += (agentOutput.key_ideas || []).map(i => `â€¢ ${i}`).join('\\n');\nmessage += `\\n\\nðŸ¦ TWEETS (${agentOutput.tweets?.length || 0}):\\n`;\n(agentOutput.tweets || []).forEach((t, i) => {\n  message += `${i+1}. [${t.type}] ${t.content}\\n`;\n});\nmessage += '\\nðŸ’¼ LINKEDIN POST:\\n';\nmessage += `Hook: ${agentOutput.linkedin_hook}\\n`;\nmessage += `Body: ${agentOutput.linkedin_body}\\n`;\nmessage += `Question: ${agentOutput.linkedin_question}`;\n\nreturn [{ json: { message } }];"
      },
      "id": "build-no-post-response",
      "name": "Build No-Post Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [880, 400]
    },
    {
      "parameters": {},
      "id": "merge-responses",
      "name": "Merge Responses",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [1540, 400]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.message }}",
        "options": {}
      },
      "id": "respond-form",
      "name": "Respond to Form",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1760, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [
            {
              "id": "has-content",
              "leftValue": "={{ $json.content }}",
              "rightValue": "",
              "operator": { "type": "string", "operation": "notEmpty" }
            },
            {
              "id": "not-error",
              "leftValue": "={{ $json.type }}",
              "rightValue": "error",
              "operator": { "type": "string", "operation": "notEquals" }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "has-valid-tweets",
      "name": "Has Valid Tweets?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [980, 200],
      "notes": "âœ… Checks tweet has content and is not an error"
    },
    {
      "parameters": {
        "content": "## POC: Multi-Tweet Poster\n\n**Flow:**\n1. AI Agent generates 3-10 tweets in ONE call\n2. Split into individual items\n3. Check if valid tweets exist\n4. Loop: Post â†’ Wait 60s â†’ Next\n5. Collect results & respond\n\n**Rate Limit Protection:**\n60-second delay between X API calls",
        "height": 380,
        "width": 400,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [-60, 100],
      "typeVersion": 1,
      "id": "note-overview",
      "name": "Note: Overview"
    }
  ],
  "pinData": {},
  "connections": {
    "Form Trigger": {
      "main": [[{ "node": "Prepare Session", "type": "main", "index": 0 }]]
    },
    "Prepare Session": {
      "main": [[{ "node": "AI Agent", "type": "main", "index": 0 }]]
    },
    "AI Agent": {
      "main": [[{ "node": "Should Post?", "type": "main", "index": 0 }]]
    },
    "Groq Chat Model": {
      "ai_languageModel": [[{ "node": "AI Agent", "type": "ai_languageModel", "index": 0 }]]
    },
    "Simple Memory": {
      "ai_memory": [[{ "node": "AI Agent", "type": "ai_memory", "index": 0 }]]
    },
    "Structured Output Parser": {
      "ai_outputParser": [[{ "node": "AI Agent", "type": "ai_outputParser", "index": 0 }]]
    },
    "Should Post?": {
      "main": [
        [{ "node": "Split Tweets", "type": "main", "index": 0 }],
        [{ "node": "Build No-Post Response", "type": "main", "index": 0 }]
      ]
    },
    "Split Tweets": {
      "main": [[{ "node": "Has Valid Tweets?", "type": "main", "index": 0 }]]
    },
    "Has Valid Tweets?": {
      "main": [
        [{ "node": "Loop Tweets", "type": "main", "index": 0 }],
        [{ "node": "Build No-Post Response", "type": "main", "index": 0 }]
      ]
    },
    "Loop Tweets": {
      "main": [
        [{ "node": "Post to X", "type": "main", "index": 0 }],
        [{ "node": "Build Posted Response", "type": "main", "index": 0 }]
      ]
    },
    "Post to X": {
      "main": [[{ "node": "Wait 60s", "type": "main", "index": 0 }]]
    },
    "Wait 60s": {
      "main": [[{ "node": "Loop Tweets", "type": "main", "index": 0 }]]
    },
    "Build No-Post Response": {
      "main": [[{ "node": "Merge Responses", "type": "main", "index": 0 }]]
    },
    "Build Posted Response": {
      "main": [[{ "node": "Merge Responses", "type": "main", "index": 0 }]]
    },
    "Merge Responses": {
      "main": [[{ "node": "Respond to Form", "type": "main", "index": 0 }]]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d5e3d527-da18-4f37-a879-efa4dbb94365",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d9154bec20a8ff27699705f29c2ba6cb7985977b93557dd9b4bc3763d6e05879"
  },
  "id": "R7tzZu07byZxSuex",
  "tags": []
}