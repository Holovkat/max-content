{
  "name": "Content Curation (Gemini)",
  "nodes": [
    {
      "parameters": {},
      "id": "workflow-trigger",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [0, 0],
      "notes": "ðŸ“¥ TRIGGER: Called by Content Generation workflow.\n\nExpected input:\n- video_id, video_title\n- tweets_glm, tweets_kimi\n- linkedin_glm, linkedin_kimi\n- newsletter_glm, newsletter_kimi"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "mode": "list",
          "value": "gemini-1.5-flash"
        },
        "promptType": "define",
        "text": "=You are the Curator - an editorial director selecting the best content.\n\nRespond in the same language as the input content. If language cannot be determined, default to English.\n\n## GENERATOR A (GLM-4.6) OUTPUTS:\n\nTweets: {{ JSON.stringify($json.tweets_glm) }}\nLinkedIn: {{ JSON.stringify($json.linkedin_glm) }}\nNewsletter: {{ JSON.stringify($json.newsletter_glm) }}\n\n## GENERATOR B (Kimi-K2) OUTPUTS:\n\nTweets: {{ JSON.stringify($json.tweets_kimi) }}\nLinkedIn: {{ JSON.stringify($json.linkedin_kimi) }}\nNewsletter: {{ JSON.stringify($json.newsletter_kimi) }}\n\n## TASK\n\nFor each content piece, score both versions 1-5 on:\n1. Hook Clarity\n2. Specificity\n3. Voice Authenticity\n4. Value Density\n5. CTA Naturalness\n\nPick the best version (or combine elements from both).\n\nReturn ONLY JSON:\n{\n  \"curated_tweets\": [\n    { \"content\": \"final tweet text\", \"source\": \"GLM|Kimi|Combined\", \"scores\": { \"glm\": N, \"kimi\": N } }\n  ],\n  \"curated_linkedin\": [\n    { \"hook\": \"\", \"body\": \"\", \"cta\": \"\", \"source\": \"GLM|Kimi|Combined\", \"scores\": { \"glm\": N, \"kimi\": N } }\n  ],\n  \"curated_newsletter\": {\n    \"subject\": \"\", \"body\": \"\", \"source\": \"GLM|Kimi|Combined\", \"scores\": { \"glm\": N, \"kimi\": N }\n  },\n  \"summary\": {\n    \"glm_wins\": N,\n    \"kimi_wins\": N,\n    \"combined\": N\n  }\n}",
        "options": {
          "temperature": 0.4,
          "maxOutputTokens": 8192
        }
      },
      "id": "gemini-curate",
      "name": "Curate Content",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [220, 0],
      "credentials": {
        "googleGeminiApi": {
          "id": "",
          "name": ""
        }
      },
      "notes": "ðŸ”§ CONFIGURATION REQUIRED:\n\n1. Add Google Gemini API credential\n2. Get API key from: aistudio.google.com\n\nThis node compares outputs from both generators and selects the best content."
    },
    {
      "parameters": {
        "jsCode": "const geminiOutput = $('Curate Content').first().json;\nconst response = geminiOutput.text || geminiOutput.content || geminiOutput.message?.content || '';\nconst input = $('Execute Workflow Trigger').first().json;\n\nlet curated;\ntry {\n  const cleaned = response.replace(/```json\\n?/gi, '').replace(/```\\n?/gi, '').trim();\n  const match = cleaned.match(/\\{[\\s\\S]*\\}/);\n  if (match) {\n    curated = JSON.parse(match[0]);\n  } else {\n    throw new Error('No JSON found');\n  }\n} catch (e) {\n  curated = { error: e.message, raw: response.substring(0, 500) };\n}\n\nreturn [{\n  json: {\n    video_id: input.video_id,\n    video_title: input.video_title,\n    curated: curated,\n    curated_at: new Date().toISOString()\n  }\n}];"
      },
      "id": "parse-curation",
      "name": "Parse Curation",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 0],
      "notes": "ðŸ“‹ AUTO-CONFIGURED:\n\nParses Gemini's curation response.\nExtracts the curated content and scores."
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "Generated_Content"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "status": "âœ…",
            "content_id": "={{ $json.video_id }}-curated",
            "video_id": "={{ $json.video_id }}",
            "curated_tweets": "={{ JSON.stringify($json.curated.curated_tweets) }}",
            "curated_linkedin": "={{ JSON.stringify($json.curated.curated_linkedin) }}",
            "curated_newsletter": "={{ JSON.stringify($json.curated.curated_newsletter) }}",
            "summary": "={{ JSON.stringify($json.curated.summary) }}",
            "created_at": "={{ $json.curated_at }}"
          }
        },
        "options": {}
      },
      "id": "store-curated",
      "name": "Store Curated Content",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [660, 0],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "",
          "name": ""
        }
      },
      "notes": "ðŸ”§ CONFIGURATION REQUIRED:\n\n1. Select Google Sheets OAuth2 credential\n2. Select 'Content Repurposing Engine' spreadsheet\n3. Select 'Generated_Content' sheet\n\nRequired columns:\nstatus | content_id | video_id | curated_tweets | curated_linkedin | curated_newsletter | summary | created_at"
    },
    {
      "parameters": {},
      "id": "return-output",
      "name": "Return Output",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [880, 0],
      "notes": "ðŸ“¤ OUTPUT:\n\nReturns curated content to main workflow.\nData includes final selected content and comparison scores."
    }
  ],
  "connections": {
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Curate Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Curate Content": {
      "main": [
        [
          {
            "node": "Parse Curation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Curation": {
      "main": [
        [
          {
            "node": "Store Curated Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store Curated Content": {
      "main": [
        [
          {
            "node": "Return Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "errorWorkflow": ""
  },
  "staticData": null,
  "tags": ["content-generation", "curation"],
  "triggerCount": 0,
  "updatedAt": "2024-12-09T00:00:00.000Z",
  "versionId": "2",
  "pinData": {},
  "meta": {
    "instanceId": ""
  }
}
